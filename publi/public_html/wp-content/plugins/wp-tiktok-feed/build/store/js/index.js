(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var c in s)e.o(s,c)&&!e.o(t,c)&&Object.defineProperty(t,c,{enumerable:!0,get:s[c]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{INITIAL_STATE:()=>r,STORE_NAME:()=>i,actions:()=>c,clearFeedCache:()=>A,fetchRestApiAccounts:()=>b,fetchRestApiFeeds:()=>w,fetchRestApiSettings:()=>k,fetchRestApiUserProfile:()=>m,reducer:()=>s,resolvers:()=>o,selectors:()=>n,storeConfig:()=>H,useAccountsEntities:()=>R,useFeedsEntities:()=>F,useSettingsEntities:()=>T});var s={};e.r(s),e.d(s,{accounts:()=>u,default:()=>g,feeds:()=>l,settings:()=>h});var c={};e.r(c),e.d(c,{createAccount:()=>j,createFeed:()=>C,deleteAccount:()=>P,deleteFeed:()=>D,editFeed:()=>I,saveSettings:()=>q,setAccounts:()=>E,setFeeds:()=>O,setSettings:()=>N});var n={};e.r(n),e.d(n,{getAccounts:()=>M,getFeeds:()=>U,getSettings:()=>L});var o={};e.r(o),e.d(o,{getAccounts:()=>$,getFeeds:()=>G,getSettings:()=>x});const a=window.wp.i18n,d=window.wp.data,i="quadlayers/tiktok",r={accounts:{},feeds:[],settings:{flush:!1,spinner_id:0}};function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.accounts,t=arguments.length>1?arguments[1]:void 0;return"SET_ACCOUNTS"===t.type?t.payload:e}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.feeds,t=arguments.length>1?arguments[1]:void 0;return"SET_FEEDS"===t.type?t.payload:e}function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.settings,t=arguments.length>1?arguments[1]:void 0;return"SET_SETTINGS"===t.type?t.payload:e}const g=(0,d.combineReducers)({accounts:u,feeds:l,settings:h}),p=window.lodash,f=window.wp.notices,S=window.wp.apiFetch;var y=e.n(S);async function v(e){return await y()(e).then((e=>{if(e.code)throw new Error(`${e.code}: ${e?.message||"Unknown"}`);return e})).catch((e=>{throw new Error(JSON.stringify(e))}))}const _=qlttf_store_routes,w=function(){let{method:e,data:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return v({path:_.feeds,method:e,data:t})};function F(){const{createFeed:e,editFeed:t,deleteFeed:s}=(0,d.useDispatch)(i),{feeds:c,isResolvingFeeds:n,hasResolvedFeeds:o}=(0,d.useSelect)((e=>{const{isResolving:t,hasFinishedResolution:s,getFeeds:c}=e(i);return{feeds:Object.values(c()),isResolvingFeeds:t("getFeeds"),hasResolvedFeeds:s("getFeeds")}}),[]);return{feeds:c,isResolvingFeeds:n,hasResolvedFeeds:o,hasFeeds:!(!o||!Object.keys(c)?.length),createFeed:e,editFeed:t,deleteFeed:s}}function A(e){let{method:t,data:s}=e;return v({path:_.cache,method:t,data:s})}const b=function(){let{method:e,data:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return v({path:_.accounts,method:e,data:t})},m=e=>{let{method:t,data:s}=e;return v({path:`${_.profile.account}`,method:t,data:s})};function R(){const{createAccount:e,deleteAccount:t}=(0,d.useDispatch)(i),{accounts:s,isResolvingAccounts:c,hasResolvedAccounts:n}=(0,d.useSelect)((e=>{const{isResolving:t,hasFinishedResolution:s,getAccounts:c}=e(i);return{accounts:Object.values(c()),isResolvingAccounts:t("getAccounts"),hasResolvedAccounts:s("getAccounts")}}),[]);return{accounts:s,isResolvingAccounts:c,hasResolvedAccounts:n,hasAccounts:!(!n||!Object.keys(s)?.length),createAccount:e,deleteAccount:t}}const k=function(){let{method:e,data:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return v({path:_.settings,method:e,data:t})};function T(){const{saveSettings:e}=(0,d.useDispatch)(i),{settings:t,isResolvingSettings:s,hasResolvedSettings:c}=(0,d.useSelect)((e=>{const{isResolving:t,hasFinishedResolution:s,getSettings:c}=e(i);return{settings:c(),isResolvingSettings:t("getSettings"),hasResolvedSettings:s("getSettings")}}),[]);return{settings:t,isResolvingSettings:s,hasResolvedSettings:c,hasSettings:!(!c||!Object.keys(t)?.length),saveSettings:e}}const E=e=>({type:"SET_ACCOUNTS",payload:e}),O=e=>({type:"SET_FEEDS",payload:e}),N=e=>({type:"SET_SETTINGS",payload:e}),j=e=>async t=>{let{registry:s,dispatch:c,select:n,resolveSelect:o}=t;const d=n.getAccounts(),i=await b({method:"POST",data:e});return i?.code?(s.dispatch(f.store).createSuccessNotice(sprintf((0,a.__)("%s: %s"),i.code,i.message),{type:"snackbar"}),!1):(c.setAccounts({...d,[i.open_id]:i}),s.dispatch(f.store).createSuccessNotice((0,a.__)("The account has been updated successfully.","wp-tiktok-feed"),{type:"snackbar"}),!0)},P=(e,t)=>async s=>{let{registry:c,dispatch:n,select:o,resolveSelect:d}=s;const i=o.getAccounts(),r=await b({method:"DELETE",data:{open_id:e}});if(r?.code)return c.dispatch(f.store).createSuccessNotice(sprintf((0,a.__)("%s: %s"),r.code,r.message),{type:"snackbar"}),!1;const u=(0,p.filter)(i,(t=>t.open_id!==e));return n.setAccounts({...u}),c.dispatch(f.store).createSuccessNotice(sprintf((0,a.__)("The account %s has been deleted.","wp-tiktok-feed"),t),{type:"snackbar"}),!0},C=e=>async t=>{let{registry:s,dispatch:c,select:n,resolveSelect:o}=t;const d=n.getFeeds(),i=await w({method:"POST",data:{feed:e}});return i?.code?(s.dispatch(f.store).createSuccessNotice(sprintf((0,a.__)("%s: %s"),i.code,i.message),{type:"snackbar"}),!1):(d.push(i),c.setFeeds([...d]),s.dispatch(f.store).createSuccessNotice((0,a.__)("The feed has been created successfully.","wp-tiktok-feed"),{type:"snackbar"}),!0)},D=e=>async t=>{let{registry:s,dispatch:c,select:n,resolveSelect:o}=t;const d=n.getFeeds(),i=await w({method:"DELETE",data:{feed_settings:e}});if(i?.code)return s.dispatch(f.store).createSuccessNotice(sprintf((0,a.__)("%s: %s"),i.code,i.message),{type:"snackbar"}),!1;const r=d.filter((t=>t.id!==e.id));return c.setFeeds([...r]),s.dispatch(f.store).createSuccessNotice(sprintf((0,a.__)("The feed %s has been deleted.","wp-tiktok-feed"),e.id),{type:"snackbar"}),!0},I=e=>async t=>{let{registry:s,dispatch:c,select:n,resolveSelect:o}=t;const d=n.getFeeds(),i=await w({method:"PATCH",data:{feed:e}});return i?.code?(s.dispatch(f.store).createSuccessNotice(sprintf((0,a.__)("%s: %s"),i.code,i.message),{type:"snackbar"}),!1):(c.setFeeds([...d.map((t=>t.id==e.id?e:t))]),s.dispatch(f.store).createSuccessNotice((0,a.__)("The feed has been updated successfully.","wp-tiktok-feed"),{type:"snackbar"}),!0)},q=e=>async t=>{let{registry:s,dispatch:c,select:n,resolveSelect:o}=t;const d=await k({method:"POST",data:e});return d?.code?(s.dispatch(f.store).createSuccessNotice(sprintf((0,a.__)("%s: %s"),d.code,d.message),{type:"snackbar"}),!1):(c.setSettings({...e}),s.dispatch(f.store).createSuccessNotice((0,a.__)("Settings saved.","wp-tiktok-feed"),{type:"snackbar"}),!0)},M=(e,t)=>t&&e.accounts[t]?e.accounts[t]:e.accounts,U=(e,t)=>t&&e.feeds[t]?e.feeds[t]:e.feeds,L=e=>e.settings,$=async()=>{try{const e=await b(),t=Object.values(e),s=await Promise.all(t.map((async e=>{const t=await m({method:"POST",data:{feedSettings:{open_id:e.open_id}}});return{...e,...t}})));return E(s)}catch(e){console.error(e)}},G=async()=>{try{const e=await w();return O(Object.values(e))}catch(e){console.error(e)}},x=async()=>{try{const e=await k();return N(e)}catch(e){console.error(e)}},H={reducer:g,actions:c,selectors:n,resolvers:o},J=(0,d.createReduxStore)(i,H);(0,d.register)(J),(window.qlttf=window.qlttf||{}).store=t})();